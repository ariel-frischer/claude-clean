constitution:
  project_name: "Claude Clean (cclean)"
  version: "1.0.0"
  ratified: "2025-12-14"
  last_amended: "2025-12-14"

preamble: |
  Claude Clean is a terminal parser that transforms Claude Code's raw stream-json output
  into beautiful, human-readable terminal output. This constitution establishes the
  quality standards and development practices that ensure reliable, maintainable code.

principles:
  - name: "Format Before Commit"
    id: "PRIN-001"
    category: "process"
    priority: "NON-NEGOTIABLE"
    description: |
      All Go code must be formatted with gofmt before committing.
      CI enforces this with format checks that fail the build.
    rationale: "Ensures consistent code style across all contributions"
    enforcement:
      - mechanism: "CI pipeline"
        description: "GitHub Actions fails build if gofmt -l finds unformatted code"
      - mechanism: "Makefile target"
        description: "make fmt provides easy formatting before commits"
    exceptions: []

  - name: "Static Analysis Clean"
    id: "PRIN-002"
    category: "quality"
    priority: "NON-NEGOTIABLE"
    description: |
      All code must pass go vet without warnings.
      Static analysis catches common errors and anti-patterns.
    rationale: "Catches bugs early before they reach production"
    enforcement:
      - mechanism: "CI pipeline"
        description: "GitHub Actions runs go vet ./... and fails on issues"
      - mechanism: "Makefile target"
        description: "make vet runs analysis locally"
    exceptions: []

  - name: "Test Coverage for Core Functions"
    id: "PRIN-003"
    category: "quality"
    priority: "MUST"
    description: |
      Core parsing and display functions must have test coverage.
      Tests are organized by output style (default, minimal, plain).
    rationale: "Prevents regressions in critical parsing logic"
    enforcement:
      - mechanism: "CI pipeline"
        description: "GitHub Actions runs tests with race detection and coverage reporting"
      - mechanism: "Makefile target"
        description: "make test runs go test -v ./..."
    exceptions:
      - "Trivial helper functions with obvious behavior"
      - "Display functions that only format output"

  - name: "Single Package Structure"
    id: "PRIN-004"
    category: "architecture"
    priority: "SHOULD"
    description: |
      The codebase uses a single-package architecture for simplicity.
      All code resides in the main package with clear file organization.
    rationale: "Maintains simplicity for a focused CLI tool"
    enforcement:
      - mechanism: "Code review"
        description: "Reviewers check that new code fits existing structure"
    exceptions:
      - "Test utilities may be placed in separate test files"
      - "Future growth may warrant package extraction"

  - name: "Pipeline Architecture"
    id: "PRIN-005"
    category: "architecture"
    priority: "MUST"
    description: |
      Message processing follows the established pipeline:
      1. Input routing (file, stdin, or live Claude execution)
      2. JSONL parsing into StreamMessage structs
      3. Duplicate detection
      4. Display routing to style-specific formatters
    rationale: "Ensures predictable data flow and easy debugging"
    enforcement:
      - mechanism: "Code review"
        description: "New features must integrate with existing pipeline stages"
    exceptions: []

  - name: "Four Output Style Variants"
    id: "PRIN-006"
    category: "architecture"
    priority: "MUST"
    description: |
      Each message type must have display functions for all four styles:
      default, compact, minimal, and plain. New message types require
      implementing all four variants.
    rationale: "Ensures consistent user experience across all output modes"
    enforcement:
      - mechanism: "Code review"
        description: "New message types must include all four style implementations"
      - mechanism: "Test coverage"
        description: "Style-specific tests verify each variant"
    exceptions: []

  - name: "Large Output Handling"
    id: "PRIN-007"
    category: "quality"
    priority: "MUST"
    description: |
      Large outputs must be handled gracefully:
      - 10MB max buffer for handling large outputs
      - Show first 20 + last 20 lines with middle summary for truncation
      - System reminder stripping in non-verbose mode
    rationale: "Prevents memory issues and maintains readable output"
    enforcement:
      - mechanism: "Code implementation"
        description: "Buffer limits and truncation logic in main.go"
    exceptions: []

  - name: "Minimal Dependencies"
    id: "PRIN-008"
    category: "architecture"
    priority: "SHOULD"
    description: |
      Keep external dependencies minimal. Current dependencies:
      - github.com/fatih/color for terminal colors
      - golang.org/x/term for terminal detection
    rationale: "Reduces attack surface and simplifies maintenance"
    enforcement:
      - mechanism: "Code review"
        description: "New dependencies require justification"
    exceptions:
      - "Standard library packages are always acceptable"

  - name: "Cross-Platform Compatibility"
    id: "PRIN-009"
    category: "quality"
    priority: "MUST"
    description: |
      The binary must work on Linux (amd64, arm64), macOS (Intel, Apple Silicon),
      and Windows. Color output must degrade gracefully on unsupported terminals.
    rationale: "Supports Claude Code users on all major platforms"
    enforcement:
      - mechanism: "Release process"
        description: "GoReleaser builds for all target platforms"
      - mechanism: "Color library"
        description: "fatih/color handles platform differences"
    exceptions: []

  - name: "Semantic Versioning"
    id: "PRIN-010"
    category: "governance"
    priority: "MUST"
    description: |
      Releases follow semantic versioning (vMAJOR.MINOR.PATCH).
      - MAJOR: Breaking changes to output format or CLI interface
      - MINOR: New features, output styles, or message type support
      - PATCH: Bug fixes and performance improvements
    rationale: "Allows users to understand impact of updates"
    enforcement:
      - mechanism: "Makefile targets"
        description: "make patch/minor/major auto-bump versions"
      - mechanism: "Git tags"
        description: "GoReleaser triggered by version tags"
    exceptions: []

sections:
  - name: "Code Quality"
    content: |
      All code must pass gofmt formatting and go vet analysis.
      Tests run with race detection enabled (-race flag).
      Coverage reports uploaded to Codecov for visibility.

  - name: "Development Workflow"
    content: |
      Use 'make all' (or 'make a') before commits to format, vet, and build.
      Run 'make test' (or 'make t') to verify changes don't break tests.
      Use 'make run' (or 'make r') to test with sample data from mocks/.

  - name: "Release Process"
    content: |
      Releases are automated via GoReleaser and GitHub Actions.
      Use 'make patch', 'make minor', or 'make major' for version bumps.
      The release workflow builds binaries for all platforms and creates GitHub releases.

  - name: "Testing Strategy"
    content: |
      Test files are organized by output style.
      Core function tests in main_test.go.
      Style-specific display tests in display_*_test.go files.
      Sample test data provided in mocks/ directory.

governance:
  amendment_process:
    - step: 1
      action: "Propose change via pull request"
      requirements: "Include rationale and impact assessment"
    - step: 2
      action: "Review period"
      requirements: "Allow time for maintainer review"
    - step: 3
      action: "Approval"
      requirements: "Requires maintainer approval"
    - step: 4
      action: "Merge and version bump"
      requirements: "Update version and last_amended date"

  versioning_policy: |
    Constitution versions follow semantic versioning.
    MAJOR: Changes that invalidate existing compliant code.
    MINOR: New principles or expanded guidance.
    PATCH: Clarifications without behavioral change.

  compliance_review:
    frequency: "as-needed"
    process: "Review principles when adding major features or changing architecture"

  rules:
    - "Changes require review by maintainer"
    - "Breaking changes to CLI interface require discussion"
    - "New output styles must implement all message type variants"

sync_impact:
  version_change: "0.0.0 -> 1.0.0"
  modified_principles: []
  added_sections:
    - "Code Quality"
    - "Development Workflow"
    - "Release Process"
    - "Testing Strategy"
  removed_sections: []
  templates_requiring_updates: []
  follow_up_todos:
    - "Consider removing .specify/memory/ directory after migration"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "1.0.0"
  created: "2025-12-14T00:00:00Z"
  artifact_type: "constitution"
