feature:
  branch: "001-go-project-restructure"
  created: "2025-12-14"
  status: "Draft"
  input: |
    | Directory   | Purpose                                                 |
    |-------------|---------------------------------------------------------|
    | cmd/cclean/ | Entry point (main.go with minimal code)                 |
    | internal/   | Private app logic (core code goes here)                 |
    | pkg/        | Reusable public packages (optional, skip if not needed) |

    Avoid src/ - that's legacy GOPATH-era practice.

    For your project with 6 files, recommended structure:
    claude-clean/
    ├── cmd/cclean/main.go    # Entry point only
    ├── internal/
    │   ├── parser/           # JSONL parsing, types
    │   └── display/          # Display formatters
    ├── go.mod
    └── Makefile

    Go restructure?

user_stories:
  - id: "US-001"
    title: "Developer navigates organized codebase"
    priority: "P1"
    as_a: "developer contributing to cclean"
    i_want: "the codebase organized following standard Go project layout conventions"
    so_that: "I can quickly locate code by its responsibility and understand the project structure at a glance"
    why_this_priority: "Project organization is foundational - affects all future development and contribution"
    independent_test: "New developer can identify where to add a new display formatter without guidance"
    acceptance_scenarios:
      - given: "a developer clones the repository"
        when: "they examine the directory structure"
        then: "they see cmd/, internal/ directories following Go conventions"
      - given: "a developer wants to modify JSONL parsing logic"
        when: "they look for parser code"
        then: "they find it in internal/parser/"
      - given: "a developer wants to add a new output style"
        when: "they look for display code"
        then: "they find all display formatters in internal/display/"

  - id: "US-002"
    title: "Maintain existing functionality after restructure"
    priority: "P1"
    as_a: "user of cclean"
    i_want: "the tool to work exactly as before after the restructure"
    so_that: "the reorganization does not break my existing workflows"
    why_this_priority: "Non-breaking change is essential - users should not be affected by internal refactoring"
    independent_test: "Run existing test suite and all tests pass"
    acceptance_scenarios:
      - given: "cclean is built from the restructured codebase"
        when: "I run it with the same inputs as before"
        then: "I get identical output"
      - given: "the restructured codebase"
        when: "the existing test suite runs"
        then: "all tests pass without modification to test logic"

  - id: "US-003"
    title: "Entry point contains minimal code"
    priority: "P2"
    as_a: "developer maintaining cclean"
    i_want: "cmd/cclean/main.go to contain only entry point logic"
    so_that: "the binary entry point is clean and all business logic is in internal packages"
    why_this_priority: "Important for maintainability but not strictly required for functionality"
    independent_test: "cmd/cclean/main.go is under 100 lines and only calls internal packages"
    acceptance_scenarios:
      - given: "the restructured codebase"
        when: "I examine cmd/cclean/main.go"
        then: "it contains only flag parsing, initialization, and calls to internal packages"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST create cmd/cclean/ directory containing the application entry point"
      testable: true
      acceptance_criteria: "cmd/cclean/main.go exists and is the only .go file in cmd/cclean/"

    - id: "FR-002"
      description: "MUST create internal/parser/ package containing JSONL parsing logic and type definitions"
      testable: true
      acceptance_criteria: "internal/parser/ contains types.go and parsing functions previously in main.go"

    - id: "FR-003"
      description: "MUST create internal/display/ package containing all display formatter functions"
      testable: true
      acceptance_criteria: "internal/display/ contains all 48 display functions (12 per style × 4 styles)"

    - id: "FR-004"
      description: "MUST update go.mod module path if necessary for internal package imports"
      testable: true
      acceptance_criteria: "go build succeeds with the new package structure"

    - id: "FR-005"
      description: "MUST relocate test files to their corresponding package directories"
      testable: true
      acceptance_criteria: "Tests are co-located with the code they test (internal/display/*_test.go, internal/parser/*_test.go)"

    - id: "FR-006"
      description: "MUST update Makefile build targets to reference new entry point location"
      testable: true
      acceptance_criteria: "'make build' compiles cmd/cclean/main.go to bin/cclean"

    - id: "FR-007"
      description: "MUST preserve all existing command-line flags and behaviors"
      testable: true
      acceptance_criteria: "All flags (-style, -verbose, -file, etc.) work identically"

    - id: "FR-008"
      description: "SHOULD NOT create pkg/ directory unless reusable public packages are identified"
      testable: true
      acceptance_criteria: "pkg/ directory does not exist or contains only genuinely reusable code"

  non_functional:
    - id: "NFR-001"
      category: "maintainability"
      description: "Code organization follows standard Go project layout conventions"
      measurable_target: "Structure matches golang-standards/project-layout recommendations"

    - id: "NFR-002"
      category: "reliability"
      description: "Restructure must not introduce regressions"
      measurable_target: "100% of existing tests pass after restructure"

    - id: "NFR-003"
      category: "usability"
      description: "Build and test commands remain simple"
      measurable_target: "'make build', 'make test' work without additional steps"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Codebase follows standard Go project layout"
      metric: "Directory structure inspection"
      target: "cmd/, internal/parser/, internal/display/ directories exist with appropriate code"

    - id: "SC-002"
      description: "All existing tests pass"
      metric: "Test suite execution"
      target: "100% pass rate on existing test cases"

    - id: "SC-003"
      description: "Binary output is identical"
      metric: "Binary size and behavior comparison"
      target: "Same binary name (bin/cclean), same output for same inputs"

    - id: "SC-004"
      description: "Entry point is minimal"
      metric: "Line count of cmd/cclean/main.go"
      target: "Under 100 lines of code"

key_entities:
  - name: "Entry Point"
    description: "The main() function that initializes and runs the application"
    attributes:
      - "Flag parsing"
      - "Input routing (file/stdin/live)"
      - "Error handling and exit codes"

  - name: "Parser"
    description: "JSONL parsing logic and stream message type definitions"
    attributes:
      - "StreamMessage struct and variants"
      - "ContentBlock types"
      - "JSON deserialization"

  - name: "Display Formatters"
    description: "Functions that render parsed messages to terminal output"
    attributes:
      - "4 output styles (default, compact, minimal, plain)"
      - "4 message types (system, assistant, user/tool_result, result)"
      - "Color and box-drawing character handling"

edge_cases:
  - scenario: "Circular import between parser and display packages"
    expected_behavior: "Design package boundaries to avoid circular dependencies; display depends on parser types, not vice versa"

  - scenario: "Test files that test multiple packages"
    expected_behavior: "Split tests appropriately or use integration test package"

  - scenario: "Global variables or init() functions in current main.go"
    expected_behavior: "Move to appropriate package or refactor to avoid package-level state"

  - scenario: "Private helper functions used across message types"
    expected_behavior: "Place in appropriate internal package based on primary responsibility"

assumptions:
  - "Current flat package structure compiles and all tests pass as baseline"
  - "No external packages depend on this module (it's an end-user binary)"
  - "The 10MB buffer constant and other configuration can live in parser or a config package"
  - "Display functions that share utilities (like truncation) can share via internal/display package-level helpers"
  - "Test mock data (mocks/) remains in project root"

constraints:
  - "Binary name must remain 'cclean' for backward compatibility"
  - "Must not break existing Makefile targets (build, test, fmt, vet, all)"
  - "Cannot use pkg/ for internal-only code per Go conventions"
  - "Import paths must use the module name from go.mod"

out_of_scope:
  - "Adding new features or functionality"
  - "Performance optimizations"
  - "Changing the public API (command-line interface)"
  - "Creating pkg/ packages for external reuse"
  - "Renaming the binary or changing installation paths"
  - "Modifying test assertions or test coverage"
  - "Documentation updates beyond code comments"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "dev (commit 148e640)"
  created: "2025-12-14T23:45:00Z"
  artifact_type: "spec"
